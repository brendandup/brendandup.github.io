<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>The Friends</title>
        <style>
            table {
                width: 100%;
            }
            table, th, td {
                border: 1px solid black;
                border-collapse: collapse;
            }
            input {
                border: none;
                width: 100%;
                box-sizing: border-box;
                -webkit-box-sizing:border-box;
                -moz-box-sizing: border-box;
                font-size: 14px;
            }
        </style>
    </head>
    <body>
        <script>
            var nbFriends = 73;
            var categories = [{name : "Name", type : "text", appearence : "show", options : []},
                              {name : "Height", type : "number", min : null, max : null, appearence : "hide", options : []},
                              {name : "Width", type : "text", appearence : "hide", options : []},
                              {name : "Gender", type : "text", appearence : "hide", options : ["Male", "Female", "Other"]},
                              {name : "Handedness", type : "text", appearence : "hide", options : ["Righty", "Lefty", "Ambidextrous", "None"]},
                              {name : "Attack", type : "text", appearence : "show", options : []},
                              {name : "Defense", type : "text", appearence : "show", options : []},
                              {name : "Speed", type : "text", appearence : "show", options : []},
                              {name : "Health", type : "text", appearence : "show", options : []},
                              {name : "Magic", type : "text", appearence : "show", options : []},
                              {name : "Strength", type : "text", appearence : "show", options : []},
                              {name : "Intelligence", type : "text", appearence : "show", options : []},
                              {name : "Combo Damage", type : "text", appearence : "show", options : []},
                              {name : "Agility", type : "text", appearence : "show", options : []},
                              {name : "Eyesight", type : "text", appearence : "hide", options : []}
                              ];
            
            var datalists = [];
            for (var i = 0; i < categories.length; i++) {
                var datalist = document.createElement('datalist');
                datalists[i].id = categories[i]["name"] + "-datalist";
                categories[i]["options"].forEach(function(data) {
                  var option = document.createElement('option');
                  option.value = data;
                  datalists[i].appendChild(option);
                });
            }
            
            if (localStorage.getItem("items") === null) {
                var items = [];
                for (var row = 0; row < nbFriends; row++) {
                    items[row] = [];
                    for (var col = 0; col < categories.length; col++) {
                        items[row][col] = null;
                    }
                }
            } else {
                var items = JSON.parse(localStorage.getItem("items"));
            }
            
            var body = document.getElementsByTagName('body')[0];
            var tbl = document.createElement('table');
            
            var thd = document.createElement('thead');
            var tr = document.createElement('tr');
            for (var col = 0; col < categories.length; col++) {
                var th = document.createElement('th');
                th.appendChild(document.innerHTML(categories[col]["name"]));
                tr.appendChild(th);
            }
            thd.appendChild(tr);
            tbl.appendChild(thd);
            
            var tbdy = document.createElement('tbody');
            for (var row = 0; row < nbFriends; row++) {
                var tr = document.createElement('tr');
                for (var col = -1; col < categories.length; col++) {
                    var td = document.createElement('td');
                    if (col === -1) {
                        td.innerHTML = row  + 1;
                    } else {   
                        var input = document.createElement('input');
                        const i = row;
                        const j = col;
                        input.id = row * categories.length + col;
                        input.value = items[i][j];
                        input.readOnly = true;
                        input.appendChild(datalists[col]);
                        input.setAttribute('list', categories[col]["name"] + "-datalist");
                        }
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                }
                tbdy.appendChild(tr);
            }
            tbl.appendChild(tbdy);
            body.appendChild(tbl);
        </script>
        
        <p><button onclick="edit()">Edit table</button></p>
        <p><button onclick="save()">Save table</button></p>
        <p><button onclick="erase()">Erase table</button></p>
        
        <script>
            function edit() {
                var itemEls = document.getElementsByTagName("input");
                for (var i = 0; i < itemEls.length; i++) {
                    itemEls[i].readOnly = false;
                    itemEls[i].type = categories[itemEls[i].id % categories.length]["type"];
                    itemEls[i].min = categories[itemEls[i].id % categories.length]["min"];
                    itemEls[i].max = categories[itemEls[i].id % categories.length]["max"];
                }
            }
            
            function save() {
                for (var row = 0; row < nbFriends; row++) {
                    for (var col = 0; col < categories.length; col++) {
                        if (col != 0) {
                            items[row][col] = document.getElementById(row * categories.length + col).value;
                        }
                    }
                }
                localStorage.setItem("items", JSON.stringify(items));
                console.log(items);
            }
            
            function erase () {
                localStorage.clear();
            }
            
        </script>
    </body>
</html>
